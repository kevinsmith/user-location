/*!
 * UserLocation v0.0.1
 * Simple library to provide the current user's location, with an optional fallback method of obtaining their coordinates.
 * 
 * https://developers.geocarrot.com
 * 
 * Licensed under Apache-2.0
 * 
 * Copyright 2016 Kevin Smith <kevin@hearsayinteractive.com>
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *   http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * 
 */
(function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.UserLocation=t():e.UserLocation=t()})(this,function(){return function(e){function t(n){if(o[n])return o[n].exports;var r=o[n]={exports:{},id:n,loaded:!1};return e[n].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var o={};return t.m=e,t.c=o,t.p="",t(0)}([function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}(),c=o(1),a=n(c),u=function(){function e(){var t=this,o=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=o.cacheTtl,i=void 0===n?604800:n,c=o.fallback,a=void 0!==c&&c,u=o.specificity,s=void 0===u?"general":u;r(this,e),this.cookieName="__ul_coords",this.coords={latitude:null,longitude:null,accuracy:null},this.opt={cacheTtl:i,fallback:a,specificity:s};var l=this.getCache(),f=void 0,d=void 0;if(l&&l.options.fallback===this.opt.fallback&&l.options.specificity===this.opt.specificity)return new Promise(function(e){t.coords=l.coords,e(t.coords)});if("exact"===s)d=this.getExact();else{if("general"!==s)throw new Error("Invalid configuration value for location specificity.");d=this.getGeneral()}return d.then(function(){return d}).catch(function(){return f="exact"===a?t.getExact():"general"===a?t.getGeneral():d})}return i(e,[{key:"getCache",value:function(){return a.default.getJSON(this.cookieName)}},{key:"getExact",value:function(){var e=this,t=new Promise(function(t,o){navigator.geolocation.getCurrentPosition(function(o){e.coords.latitude=o.coords.latitude,e.coords.longitude=o.coords.longitude,e.coords.accuracy=o.coords.accuracy,e.setCache(e.coords),t(e.coords)},function(e){o(e.message+" (error code: "+e.code+")")})});return t}},{key:"getGeneral",value:function(){var e=this,t=new Promise(function(t,o){fetch("https://geoip.nekudo.com/api/",{}).then(function(n){n.ok?n.json().then(function(n){"error"===n.type?o(n.msg):(e.coords.accuracy=1e3*n.location.accuracy_radius,e.coords.latitude=n.location.latitude,e.coords.longitude=n.location.longitude,e.setCache(e.coords),t(e.coords))}):o(n.statusText)}).catch(function(e){o(e.message)})});return t}},{key:"setCache",value:function(e){a.default.set(this.cookieName,{coords:e,options:this.opt},{expires:this.opt.cacheTtl/24/60/60})}}]),e}();t.default=u,e.exports=t.default},function(e,t,o){var n,r;(function(i){n=i,r="function"==typeof n?n.call(t,o,t,e):n,!(void 0!==r&&(e.exports=r))})(function(){function e(){for(var e=0,t={};e<arguments.length;e++){var o=arguments[e];for(var n in o)t[n]=o[n]}return t}function t(o){function n(t,r,i){var c;if("undefined"!=typeof document){if(arguments.length>1){if(i=e({path:"/"},n.defaults,i),"number"==typeof i.expires){var a=new Date;a.setMilliseconds(a.getMilliseconds()+864e5*i.expires),i.expires=a}try{c=JSON.stringify(r),/^[\{\[]/.test(c)&&(r=c)}catch(e){}return r=o.write?o.write(r,t):encodeURIComponent(String(r)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)),t=t.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent),t=t.replace(/[\(\)]/g,escape),document.cookie=[t,"=",r,i.expires&&"; expires="+i.expires.toUTCString(),i.path&&"; path="+i.path,i.domain&&"; domain="+i.domain,i.secure?"; secure":""].join("")}t||(c={});for(var u=document.cookie?document.cookie.split("; "):[],s=/(%[0-9A-Z]{2})+/g,l=0;l<u.length;l++){var f=u[l].split("="),d=f.slice(1).join("=");'"'===d.charAt(0)&&(d=d.slice(1,-1));try{var p=f[0].replace(s,decodeURIComponent);if(d=o.read?o.read(d,p):o(d,p)||d.replace(s,decodeURIComponent),this.json)try{d=JSON.parse(d)}catch(e){}if(t===p){c=d;break}t||(c[p]=d)}catch(e){}}return c}}return n.set=n,n.get=function(e){return n(e)},n.getJSON=function(){return n.apply({json:!0},[].slice.call(arguments))},n.defaults={},n.remove=function(t,o){n(t,"",e(o,{expires:-1}))},n.withConverter=t,n}return t(function(){})})}])});
//# sourceMappingURL=UserLocation.min.js.map
